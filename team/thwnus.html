<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.6.1"><title>Tee Hao Wei — Project Portfolio</title><link rel="stylesheet" href="../stylesheets/gh-pages.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../stylesheets/coderay-asciidoctor.css"></head><body class="article"><div id="site-header"><nav class="navbar navbar-light bg-light"><div class="container"><a class="navbar-brand" href="../index.html">Budget Buddy</a><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../UserGuide.html">User Guide</a></li><li class="nav-item"><a class="nav-link" href="../DeveloperGuide.html">Developer Guide</a></li><li class="nav-item"><a class="nav-link active" href="../AboutUs.html">About Us</a></li><li class="nav-item"><a class="nav-link" href="../ContactUs.html">Contact Us</a></li><li class="navitem"><a class="nav-link" href="https://github.com/AY1920S1-CS2103T-W13-4/main"><span class="fa fa-github fa-lg" aria-hidden="true"></span>&nbsp;View on GitHub</a></li></ul></div></nav></div><div id="header"><h1>Tee Hao Wei — Project Portfolio</h1></div><div id="content"><div class="sect1">
<h2 id="project-budget-buddy"><a class="link" href="#project-budget-buddy">PROJECT: Budget Buddy</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="link" href="#overview">Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Budget Buddy is a desktop expense tracker application that allows users to track their expenses. The main method of input by the user is using a command-line interface (CLI), but the application presents information using a graphical interface. It targets users from the School of Computing in the National University of Singapore, who are generally comfortable with command-line interfaces.</p>
</div>
<div class="paragraph">
<p>Budget Buddy has the usual requisite features of an expense tracker: transactions, accounts, categories, loan tracking and a loan splitter. Because we are targetting computing students, Budget Buddy also has a scripting engine, allowing users to write scripts that perform complex operations and extend the functionality of the application.</p>
</div>
<div class="paragraph">
<p>Budget Buddy benefits users by allowing them to know what they are spending on, so they can make informed decisions to change their spending behaviour and achieve their financial goals.</p>
</div>
<div class="paragraph">
<p>Budget Buddy is based on the AddressBook-Level3 application by SE-EDU, and currently consists of about 15 thousand lines of code.</p>
</div>
<div class="paragraph">
<p>My main contributions are the scripting engine, as well as managing releases and integrating contributions from other team members.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary-of-contributions"><a class="link" href="#summary-of-contributions">Summary of contributions</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section summarises the contributions I made to Budget Buddy.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><strong>Major enhancement</strong>: added a scripting engine and library, as well as script bindings for accounts, transactions and loans</p>
<div class="ulist">
<ul>
<li>
<p>What: This feature provides the user the ability to evaluate arbitrary scripts which have full access to the data and user interface of the application, and save these scripts in a library for convenient reuse.</p>
</li>
<li>
<p>Why: This feature allows the user to perform complex operations that may be inconvenient or impossible to do through the CLI, and extend the application with new commands and features on their own, without having to modify the application&#8217;s source code directly.</p>
</li>
<li>
<p>Highlights: This feature required thought to provide a ergonomic scripting interface to allow scripts to do common operations easily, without restricting scripts from doing more complex operations.</p>
</li>
<li>
<p>Credits: This feature is implemented using the Nashorn JavaScript engine, bundled with Java 11.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Minor enhancement</strong>: enhanced the command result mechanism to allow continuations, such as showing a file picker and performing actions after that; see <a href="https://github.com/AY1920S1-CS2103T-W13-4/main/pull/170">PR #170</a>.</p>
</li>
<li>
<p><strong>Code contributed</strong>: See the <a href="https://nus-cs2103-ay1920s1.github.io/tp-dashboard/#search=thwnus&amp;tabOpen=true&amp;tabType=authorship&amp;tabAuthor=thwnus&amp;tabRepo=AY1920S1-CS2103T-W13-4%2Fmain[master]">RepoSense report here</a>.</p>
</li>
<li>
<p><strong>Other contributions</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Project management:</p>
<div class="ulist">
<ul>
<li>
<p>Managed releases v1.1 to v1.4 (4 releases) on GitHub</p>
</li>
</ul>
</div>
</li>
<li>
<p>Community:</p>
<div class="ulist">
<ul>
<li>
<p>Helped to rebase and merge PRs, many with non-trivial merge conflicts, including PRs <a href="https://github.com/AY1920S1-CS2103T-W13-4/main/pull/55">#55</a>, <a href="https://github.com/AY1920S1-CS2103T-W13-4/main/pull/66">#66</a>, <a href="https://github.com/AY1920S1-CS2103T-W13-4/main/pull/85">#85</a>, <a href="https://github.com/AY1920S1-CS2103T-W13-4/main/pull/157">#157</a>, and <a href="https://github.com/AY1920S1-CS2103T-W13-4/main/pull/162">#162</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Tools:</p>
<div class="ulist">
<ul>
<li>
<p>Integrated Netlify, Coveralls and Codacy to the team repository</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributions-to-the-user-guide"><a class="link" href="#contributions-to-the-user-guide">Contributions to the User Guide</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section includes the parts of the user guide that I wrote, to demonstrate my ability to write end-user facing documentation.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="Scripting"><a class="link" href="#Scripting">Scripting: <code>script</code></a></h3>
<div class="imageblock">
<div class="content">
<img src="../images/scriptpanel.png" alt="scriptpanel" width="85%">
</div>
<div class="title">Figure 1. Scripts in the script tab</div>
</div>
<div class="paragraph">
<p>The scripting engine allows you to evaluate arbitrary scripts to perform complex operations on your transaction data,
as well as extend the application and add commands and features of your own.</p>
</div>
<div class="paragraph">
<p>The scripting language is JavaScript (specifically, ECMAScript 5.1). For more details on the scripting environment and API, see <a href="#scripting-api">here</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Scripts have full access to the application&#8217;s internals, as well as all Java standard library classes and APIs.
It is possible to corrupt the application state by execution of a malicious or buggy script. There are no guarantees on
application behaviour if scripts are used.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="script-eval"><a class="link" href="#script-eval">Evaluate a script: <code>script eval</code></a></h4>
<div class="paragraph">
<p>Evaluates a script and displays the result, which is the last expression evaluated in the script.</p>
</div>
<div class="paragraph">
<p>Format: <code>script eval &lt;script&gt;</code></p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>script eval 1</code></p>
<div class="paragraph">
<p>Evaluates to: <code>1</code></p>
</div>
</li>
<li>
<p><code>addTxn(1000, 'out', 'Lunch')</code></p>
<div class="paragraph">
<p>Adds an out-transaction for $10 with description "Lunch".</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="script-add"><a class="link" href="#script-add">Add a stored script: <code>script add</code></a></h4>
<div class="paragraph">
<p>Stores a script for future invocation. If a script with the same name already exists, that script is replaced.</p>
</div>
<div class="paragraph">
<p>Format: <code>script add &lt;script name&gt; [d/&lt;description&gt;] [p/&lt;file path&gt;|s/&lt;script&gt;]</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Script names may contain only alphanumeric characters, underscores, and dashes.</p>
</li>
<li>
<p>Script names are case-sensitive.</p>
</li>
<li>
<p>The file path may be absolute or relative. If it is relative, it is relative to the <em>current working directory</em> of Budget Buddy.</p>
<div class="ulist">
<ul>
<li>
<p>If you launched Budget Buddy from the command line, the current working directory starts from the directory your shell was in.</p>
</li>
<li>
<p>If you launched Budget Buddy by double-clicking the JAR file, the current working directory is typically the directory the JAR file is in.</p>
</li>
<li>
<p>There is no command that changes the current working directory, but a script may have done that.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If neither a file path nor the script code is given, a file picker is opened for you to
select the script file.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The script is not checked for correctness before it is stored. Any syntax errors
will be reported only when the script is run.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>script add hello-world s/"Hello world!"</code></p>
<div class="paragraph">
<p>Adds a script named <code>hello-world</code> that simply results in "Hello world!" being printed.</p>
</div>
</li>
<li>
<p><code>script add add-transport d/Adds today&#8217;s transport fare.</code></p>
<div class="paragraph">
<p>Adds a script named <code>add-transport</code> with description "Adds today&#8217;s transport fare.". A file picker is opened for you to select the script file.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="script-delete"><a class="link" href="#script-delete">Delete a stored script: <code>script delete</code></a></h4>
<div class="paragraph">
<p>Deletes a previously-stored script.</p>
</div>
<div class="paragraph">
<p>Format: <code>script delete &lt;script name&gt;</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Script names are case-sensitive.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script-run"><a class="link" href="#script-run">Run a stored script: <code>script run</code></a></h4>
<div class="paragraph">
<p>Runs a previously-stored script and displays the result, which is the last expression evaluated in the script.</p>
</div>
<div class="paragraph">
<p>Format: <code>script run &lt;script name&gt; [&lt;argument&gt;]</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Script names are case-sensitive.</p>
</li>
<li>
<p>The script is run in the current script environment, which may contain variables from previous scripts that have run.</p>
</li>
<li>
<p>The argument is the rest of the input after the script name, and is passed to the script as a single string.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>script run add-transport</code></p>
<div class="paragraph">
<p>Runs the script named <code>add-transport</code>. <code>argv</code> is an empty array.</p>
</div>
</li>
<li>
<p><code>script run echo Hello world!</code></p>
<div class="paragraph">
<p>Runs the script named <code>echo</code>, with <code>argv[0]</code> set to <code>"Hello world!"</code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="script-list"><a class="link" href="#script-list">List stored scripts: <code>script list</code></a></h4>
<div class="paragraph">
<p>Lists stored scripts.</p>
</div>
<div class="paragraph">
<p>Format: <code>script list</code></p>
</div>
</div>
<div class="sect3">
<h4 id="script-reset"><a class="link" href="#script-reset">Reset the scripting environment: <code>script reset</code></a></h4>
<div class="paragraph">
<p>Resets the scripting environment. This clears all previously defined variables, and restores all global variables and functions that may have been modified by scripts.</p>
</div>
<div class="paragraph">
<p>Format: <code>script reset</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The following is part of the Script API guide that I wrote, to demonstrate my ability to write end-user facing documentation for power users. <a href="https://ay1920s1-cs2103t-w13-4.github.io/main/UserGuide.html#scripting-api">See here for the full script API guide.</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="scripting-api"><a class="link" href="#scripting-api">Scripting API</a></h3>
<div class="paragraph">
<p>The Nashorn scripting engine is used. All features and Java class access of the Nashorn engine are available. See the <a href="https://docs.oracle.com/en/java/javase/11/nashorn/nashorn-java-api.html">Nashorn documentation</a> for more details.</p>
</div>
<div class="paragraph">
<p>Budget Buddy defines a few global variables and functions to ease script writing. These are documented below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to the nature of JavaScript, scripts may modify these variables and functions. To reset the script
environment, use <a href="#script-reset">the <code>script reset</code> command</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="functions"><a class="link" href="#functions">Functions</a></h4>
<div class="paragraph">
<p>The following helper functions are predefined in the script environment.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Function signatures</strong></p>
</div>
<div class="paragraph">
<p>Function signatures specified below are in the following format:</p>
</div>
<div class="paragraph">
<p><code>functionName(parameter1, parameter2, { optionalParameter1, optionalParameter2 }) &#8594; ReturnType</code></p>
</div>
<div class="paragraph">
<p>Optional arguments should be given as a single JavaScript object. For example, for the above signature:</p>
</div>
<div class="paragraph">
<p><code>functionName("argument 1", "argument 2", { optionalParameter1: "optional argument 1" })</code></p>
</div>
<div class="paragraph">
<p><strong>Types</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the type starts with a capital letter e.g. <code>Account</code>, it is a Java type.</p>
</li>
<li>
<p>If the type starts with a lowercase letter e.g. <code>number</code>, it is a JavaScript primitive.</p>
</li>
<li>
<p>If the type is <code>[Type]</code>, it is an array of <code>Type</code>.</p>
</li>
<li>
<p>If a function&#8217;s return type is unspecified, the function does not return a value.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="account-functions"><a class="link" href="#account-functions">Account functions</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>addAccount(name, description) &#8594; Account</code></p>
<div class="paragraph">
<p>Adds an account with the given name and description.</p>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: the name of the account, as a <code>string</code></p>
</li>
<li>
<p><code>description</code>: the description of the account, as a <code>string</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr>
<div class="ulist">
<ul>
<li>
<p><code>morphAccount(oldAccount, { name, description }) &#8594; Account</code></p>
<div class="paragraph">
<p>Returns a new <code>Account</code> that is the same as <code>oldAccount</code> except for the specified properties changed.</p>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>oldAccount</code>: the <code>Account</code> to morph</p>
</li>
<li>
<p>The remaining parameters are as in <code>addAccount</code>.</p>
</li>
<li>
<p>If a parameter is not specified, then the associated property is not changed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributions-to-the-developer-guide"><a class="link" href="#contributions-to-the-developer-guide">Contributions to the Developer Guide</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section includes the parts of the developer guide that I wrote, to demonstrate my ability to write technical documentation and the technical depth of my contributions to the project.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="scripting"><a class="link" href="#scripting">Scripting</a></h3>
<div class="paragraph">
<p>The scripting feature allows users to write scripts to automate tasks and extend the
functionality of Budget Buddy.</p>
</div>
<div class="sect3">
<h4 id="implementation"><a class="link" href="#implementation">Implementation</a></h4>
<div class="paragraph">
<p>The script engine works independently of the rest of the application.
At its core, it uses the
<a href="https://docs.oracle.com/en/java/javase/11/nashorn/nashorn-java-api.html">Nashorn ECMAScript 5.1</a>
engine bundled with Java 11 to evaluate scripts.</p>
</div>
<div class="paragraph">
<p>A set of convenience functions are provided to make basic tasks, such as manipulating
transactions and accounts, easier. The full model is nevertheless exposed to
scripts, and scripts are able to access any classes provided in the Java 11 standard
library, as well as any dependencies included in the application.</p>
</div>
<div class="paragraph">
<p>There is a simple mechanism to store scripts to be run in future. This works together
with rules to give the ability to have complex predicates and actions outside of
those supported inherently by the program.</p>
</div>
<div class="paragraph">
<p>When the <a href="#aliases">proposed alias feature</a> is implemented, scripts and aliases can be
used together to, in effect, allow users to create custom commands.</p>
</div>
<div class="paragraph">
<p>The following class diagram illustrates the design of the script engine and model. For clarity, parts of the model and logic components that do not interact directly with the script engine are omitted.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ScriptsClassDiagram.png" alt="ScriptsClassDiagram">
</div>
<div class="title">Figure 2. Structure of scripts in the model and logic components</div>
</div>
<div class="sect4">
<h5 id="script-engine"><a class="link" href="#script-engine">Script engine</a></h5>
<div class="paragraph">
<p>The logic component of the scripts feature contains the
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/logic/script/ScriptEngine.java"><code>ScriptEngine</code></a>
class which underpins the entire scripting component. At its heart, the <code>ScriptEngine</code> class is
simply a thin layer to abstract away the underlying script engine (in our case, Nashorn). It contains a method
<code>evaluateScript</code> that accepts a string of script code, and arguments for the script, and
then evaluates the script. There is an overload of <code>evaluateScript</code> that accepts a <code>Script</code>
from the script model, which is simply a convenience method. There is no other relationship
between the logic and model components.</p>
</div>
<div class="paragraph">
<p>The logic component also contains methods <code>setVariable</code>, <code>addToEnvironment</code> and <code>resetEnvironment</code>
that allow functions and variables to be set in the script environment, to provide helper functions
to the scripts, like those in the <a href="UserGuide.html#scripting-api">Scripting API</a>.</p>
</div>
<div class="paragraph">
<p>To allow other components to add helper functions to the script environment,
without the script engine having to be aware of those components,
the <code>ScriptEngine</code> accepts <code>ScriptEnvironmentInitialiser</code>s. A <code>ScriptEnvironmentInitialiser</code>
is a <code>FunctionalInterface</code> that simply accepts a <code>ScriptEngine</code> and does some setup
on it e.g. setting variables and functions using <code>ScriptEngine#setVariable</code>. <code>ScriptEngine</code>
maintains a list of <code>ScriptEnvironmentInitialiser</code>s and re-applies them each time
<code>ScriptEngine#resetEnvironment</code> is called.</p>
</div>
</div>
<div class="sect4">
<h5 id="library-and-storage"><a class="link" href="#library-and-storage">Library and storage</a></h5>
<div class="paragraph">
<p>The model component of the scripts feature is a simple script library that allows
users to store scripts with a name and a description for repeated use. See the interface
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/model/ScriptLibrary.java"><code>ScriptLibrary</code></a>
and its implementation
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/model/ScriptLibraryManager.java"><code>ScriptLibraryManager</code></a>.</p>
</div>
<div class="paragraph">
<p>Scripts are persisted as individual files under the <code>scripts/</code> directory in
Budget Buddy&#8217;s data directory. Script names are not stored separately, but simply
used as the file name of the scripts with a <code>.js</code> extension. See
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/storage/scripts/FlatfileScriptsStorage.java"><code>FlatfileScriptsStorage</code></a>.</p>
</div>
<div class="paragraph">
<p>The script descriptions are stored in a separate <code>descriptions.json</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="user-interface"><a class="link" href="#user-interface">User interface</a></h5>
<div class="paragraph">
<p>The last component of the scripts feature is the user interface.</p>
</div>
<div class="paragraph">
<p>The script engine is presented to the user as a set of simple commands.
<a href="UserGuide.html#script-eval"><code>script eval</code></a> and <a href="UserGuide.html#script-run"><code>script run</code></a>
run scripts, while <a href="UserGuide.html#script-reset"><code>script reset</code></a> resets the script environment.
<a href="UserGuide.html#script-add"><code>script add</code></a>, <a href="UserGuide.html#script-list"><code>script list</code></a>
and <a href="UserGuide.html#script-delete"><code>script delete</code></a> manage the script library.</p>
</div>
<div class="paragraph">
<p>The following sequence diagram shows the interaction between the different components
when the user runs a script from the script library using <code>script run my-script</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ScriptsSequenceDiagram.png" alt="ScriptsSequenceDiagram">
</div>
<div class="title">Figure 3. Interaction between the components during the execution of <code>script run my-script</code></div>
</div>
<div class="paragraph">
<p>The command is parsed into <code>ScriptRunCommand</code> by the command line parser.
<code>ScriptRunCommand</code> then retrieves the <code>Script</code> from the <code>ScriptLibraryManager</code>
and then hands the <code>Script</code> to <code>ScriptEngine</code> for evaluation.</p>
</div>
</div>
<div class="sect4">
<h5 id="script-bindings"><a class="link" href="#script-bindings">Script bindings</a></h5>
<div class="paragraph">
<p>Script bindings are added via
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/logic/script/ScriptEnvironmentInitialiser.java"><code>ScriptEnvironmentInitialiser</code>s</a>, which are registed with the <code>ScriptEngine</code> through <code>Logic#addToScriptEnvironment</code>.</p>
</div>
<div class="paragraph">
<p>Most of the functions exposed in the <a href="UserGuide.html#scripting-api">Scripting API</a>
come from the script-model bindings, in
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/logic/script/ScriptModelBinding.java"><code>ScriptModelBinding</code></a>.
JavaFX-specific bindings are added in
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/ui/ScriptUiBinding.java"><code>ScriptUiBinding</code></a>,
and bindings that require access to <code>MainWindow</code> internals are added in a private inner class of <code>MainWindow</code>.</p>
</div>
<div class="paragraph">
<p>Methods in the binding classes are added into the script environment by casting
their method references to appropriate <code>FunctionalInterface</code>s. Nashorn allows
objects which implement a <code>FunctionalInterface</code> to be called as if they were
functions, providing an ergonomic scripting experience for the user. Nashorn also
helps to do some type conversion from JavaScript types to Java types, saving on
the amount of boilerplate required in our implementation.</p>
</div>
<div class="paragraph">
<p>We declare an
entire suite of functional interfaces in
<a href="https://github.com/AY1920S1-CS2103T-W13-4/main/blob/master/src/main/java/budgetbuddy/logic/script/ScriptBindingInterfaces.java"><code>ScriptBindingInterfaces</code></a>.</p>
</div>
<div class="paragraph">
<p>We do not use the functional interfaces provided in the Java package <code>java.util.function</code>
because of these reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>These interfaces cannot be used if the methods throw any checked exceptions.
Many script methods involve parsing strings into appropriate model types, which
means that parsing exceptions need to be thrown, but they are checked exceptions.</p>
</li>
<li>
<p>These interfaces have generic type parameters. However, because Java implements
generics using type erasure, it is not possible for Nashorn to determine the actual
types of parameters, in order to do automatic conversion between JavaScript and Java
types, if functional interfaces with generic type parameters were used.
(They would all appear as <code>Object</code> at runtime.) This is also the reason that we do
not use generics in the functional interfaces in <code>ScriptBindingInterfaces</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="design-considerations"><a class="link" href="#design-considerations">Design considerations</a></h4>
<div class="sect4">
<h5 id="aspect-javascript-engine"><a class="link" href="#aspect-javascript-engine">Aspect: JavaScript engine</a></h5>
<div class="paragraph">
<p>Two JavaScript engines were considered.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Alternative 1 (current choice)</strong>: Use the Nashorn JavaScript engine.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: It is bundled with Java 11.</p>
</li>
<li>
<p>Cons: It is deprecated and marked for removal in a future Java version, and
it also interprets scripts, so it is slower than GraalVM.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Alternative 2</strong>: Use the GraalVM engine.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: It is well-maintained, and it also just-in-time (JIT) compiles scripts,
so it will be faster than Nashorn.</p>
</li>
<li>
<p>Cons: It is not bundled with Java 11, so it is an additional dependency.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We chose Nashorn because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>While it is slower, it is not too slow for the kinds of lightweight scripting tasks
in Budget Buddy.</p>
</li>
<li>
<p>While it is deprecated, we are targetting specifically Java 11, so its future removal
is not a concern at this moment.</p>
</li>
<li>
<p>It is bundled with Java 11, so we do not need to manage and ship an additional
dependency.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="aspect-script-bindings"><a class="link" href="#aspect-script-bindings">Aspect: Script bindings</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Alternative 1 (current choice)</strong>: Use functional interfaces.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: It requires less marshalling code in Budget Buddy, because Nashorn helps
to perform most of the type conversion.</p>
</li>
<li>
<p>Cons: Many functional interfaces need to be declared for every unique method
signature exposed to the script environment.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Alternative 2</strong>: Extend Nashorn&#8217;s
<a href="https://docs.oracle.com/javase/8/docs/jdk/api/nashorn/jdk/nashorn/api/scripting/AbstractJSObject.html"><code>AbstractJSObject</code></a>,
overriding the <code>call</code> method.</p>
<div class="ulist">
<ul>
<li>
<p>Pros: No extra declarations (e.g. functional interfaces) need to be made if a
new method signature is to be exposed to the script environment.</p>
</li>
<li>
<p>Cons: Nashorn&#8217;s built-in type conversion and marshalling are not applicable; it
has to be done manually in our <code>AbstractJSObject</code> subclass.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aliases"><a class="link" href="#aliases">[Proposed] Aliases</a></h3>
<div class="paragraph">
<p>The alias is a simple hook into the command parsing engine. If there is no
built-in command corresponding to a command line, then the alias map is checked.
If there is a matching alias, then the alias name in the command line is replaced,
and the command execution is re-tried.</p>
</div>
<div class="paragraph">
<p>To prevent alias loops where the user creates an alias <code>x</code> mapping to <code>y</code>, and an
alias <code>y</code> mapping to <code>x</code>, we track the aliases that have been applied, and
stop evaluation if we see that the same alias has been applied more than once.</p>
</div>
<div class="paragraph">
<p>The following activity diagram illustrates the above algorithm.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/AliasActivityDiagram.png" alt="AliasActivityDiagram">
</div>
<div class="title">Figure 4. Alias resolution algorithm</div>
</div>
</div>
</div>
</div></div><div id="footer"><div class="container"><div id="footer-text">Last updated 2019-11-11 15:32:06 UTC</div></div></div></body></html>